{"version":3,"file":"prescreener/autocomplete-init.js","names":["attach","inputSel","hiddenSel","src","input","document","querySelector","hidden","fetch","then","r","json","list","current","setAttribute","box","createElement","className","style","border","display","parentNode","appendChild","addEventListener","q","value","toLowerCase","trim","filter","item","name","includes","slice","length","innerHTML","map","i","join","e","target","matches","parseInt","getAttribute","code","mirrorLabel","getElementById","id","replace","mirrorCode","contains","catch","window","initAutocomplete"],"sources":["prescreener/autocomplete-init.js"],"sourcesContent":["// app/assets/javascripts/prescreener/autocomplete-init.js\n(function () {\n  function attach(inputSel, hiddenSel, src) {\n    var input = document.querySelector(inputSel);\n    var hidden = document.querySelector(hiddenSel);\n    if (!input || !hidden) return;\n\n    fetch(src).then(r => r.json()).then(list => {\n      var current = [];\n      input.setAttribute('autocomplete', 'off');\n\n      var box = document.createElement('div');\n      box.className = 'nhsuk-u-padding-2 nhsuk-u-margin-top-1';\n      box.style.border = '1px solid #b1b4b6';\n      box.style.display = 'none';\n      input.parentNode.appendChild(box);\n\n      input.addEventListener('input', function () {\n        var q = input.value.toLowerCase().trim();\n        current = list.filter(item => item.name.toLowerCase().includes(q)).slice(0, 8);\n        if (!q || current.length === 0) {\n          box.style.display = 'none';\n          return;\n        }\n        box.innerHTML = current.map((item, i) =>\n          '<button type=\"button\" data-i=\"' + i + '\" class=\"nhsuk-button nhsuk-button--secondary\" style=\"display:block;margin-bottom:6px;\">' + item.name + '</button>'\n        ).join('');\n        box.style.display = 'block';\n      });\n\n      box.addEventListener('click', function (e) {\n        if (e.target && e.target.matches('button[data-i]')) {\n          var item = current[parseInt(e.target.getAttribute('data-i'), 10)];\n          input.value = item.name;\n          hidden.value = item.code;\n          box.style.display = 'none';\n          // mirror into hidden fields used by the add form\n          var mirrorLabel = document.getElementById(input.id.replace('-search','') + '-hidden-label');\n          var mirrorCode = document.getElementById(input.id.replace('-search','') + '-hidden-code');\n          if (mirrorLabel) mirrorLabel.value = item.name;\n          if (mirrorCode) mirrorCode.value = item.code;\n        }\n      });\n\n      document.addEventListener('click', function (e) {\n        if (!box.contains(e.target) && e.target !== input) box.style.display = 'none';\n      });\n    }).catch(function(){});\n  }\n\n  window.initAutocomplete = function (inputSel, hiddenSel, src) {\n    attach(inputSel, hiddenSel, src);\n  };\n})();\n"],"mappings":"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","ignoreList":[]}