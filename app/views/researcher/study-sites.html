{% extends "researcher/layout-researcher.html" %}
{% block pageTitle %}Study sites{% endblock %}

{% block researcherContent %}
<h1 class="nhsuk-heading-l">Study sites</h1>
<p class="nhsuk-body">
  Sites from your feasibility check are listed below. Add the site contact details for each.
</p>

{% if errors and errors.length %}
  <div class="nhsuk-error-summary" role="alert" aria-labelledby="error-summary-title" tabindex="-1">
    <h2 class="nhsuk-error-summary__title" id="error-summary-title">There is a problem</h2>
    <div class="nhsuk-error-summary__body">
      <ul class="nhsuk-list nhsuk-error-summary__list">
        {% for e in errors %}
          <li><a href="{{ e.href }}">{{ e.text }}</a></li>
        {% endfor %}
      </ul>
    </div>
  </div>
{% endif %}

<form method="post" action="/researcher/study-sites" novalidate>
  {% if model and model.list and model.list.length %}
    <h2 class="nhsuk-heading-m">Sites to complete</h2>

    <div class="nhsuk-form-group">
      {% for s in model.list %}
        <fieldset class="nhsuk-fieldset nhsuk-u-padding-bottom-2 nhsuk-u-margin-bottom-4" id="row-{{ loop.index0 }}">
          <legend class="nhsuk-fieldset__legend nhsuk-fieldset__legend--s">
            <strong>{{ s.name }}</strong>
          </legend>

          {# Keep name posted back, but visually treat as read-only #}
          <input type="hidden" name="list[{{ loop.index0 }}][name]" value="{{ s.name }}">

          <div class="nhsuk-grid-row nhsuk-u-margin-top-3">
            <div class="nhsuk-grid-column-one-half">
              <label class="nhsuk-label" for="row-{{ loop.index0 }}-contactName">Study site contact name</label>
              <input class="nhsuk-input" id="row-{{ loop.index0 }}-contactName" name="list[{{ loop.index0 }}][contactName]" value="{{ s.contactName }}">
            </div>
            <div class="nhsuk-grid-column-one-half">
              <label class="nhsuk-label" for="row-{{ loop.index0 }}-contactEmail">Study site contact email</label>
              <input class="nhsuk-input" id="row-{{ loop.index0 }}-contactEmail" name="list[{{ loop.index0 }}][contactEmail]" value="{{ s.contactEmail }}">
            </div>
          </div>

          <div class="nhsuk-u-margin-top-2">
            <button class="nhsuk-link" name="removeIndex" value="{{ loop.index0 }}" type="submit">Remove this site</button>
          </div>
        </fieldset>
      {% endfor %}
    </div>
  {% endif %}

  <h2 class="nhsuk-heading-m nhsuk-u-margin-top-4">Add another site</h2>
  <div id="add-site-block" class="nhsuk-form-group nhsuk-u-margin-bottom-6">

    <label class="nhsuk-label" for="name">Study site name</label>
    <input class="nhsuk-input nhsuk-!-width-two-thirds" id="name" name="name">

    {# PI fields removed #}

    <label class="nhsuk-label nhsuk-u-margin-top-3" for="contactName">Study site contact name</label>
    <input class="nhsuk-input nhsuk-!-width-two-thirds" id="contactName" name="contactName">

    <label class="nhsuk-label nhsuk-u-margin-top-3" for="contactEmail">Study site contact email</label>
    <input class="nhsuk-input nhsuk-!-width-two-thirds" id="contactEmail" name="contactEmail">

    <button class="nhsuk-button nhsuk-button--secondary nhsuk-u-margin-top-4" type="submit" name="addSite" value="yes">
      Add site
    </button>
  </div>

  <div class="nhsuk-button-group nhsuk-u-margin-top-4">
    <button class="nhsuk-button" type="submit">Save and continue</button>
    <a class="nhsuk-link" href="/researcher/task-list">Return to task list</a>
  </div>
</form>
{% endblock %}
