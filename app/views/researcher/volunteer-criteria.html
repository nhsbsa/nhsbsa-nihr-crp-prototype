{% extends "researcher/layout-researcher.html" %}
{% block pageTitle %}Matching criteria{% endblock %}
{% block researcherContent %}
<a class="nhsuk-back-link" href="/researcher/task-list">Back to task list</a>
<h1 class="nhsuk-heading-l">Matching criteria</h1>
<p class="nhsuk-body">These rules refine your feasibility estimate. As you narrow criteria, your matched estimate updates.</p>

<div class="nhsuk-card nhsuk-u-margin-bottom-5">
  <div class="nhsuk-card__content">
    <h2 class="nhsuk-heading-m nhsuk-u-margin-bottom-2">Summary</h2>
    <dl class="nhsuk-summary-list">
      <div class="nhsuk-summary-list__row">
        <dt class="nhsuk-summary-list__key">Estimated available (feasibility)</dt>
        <dd class="nhsuk-summary-list__value">{{ data.feasibility and data.feasibility.totalEstimate or '—' }}</dd>
      </div>
      <div class="nhsuk-summary-list__row">
        <dt class="nhsuk-summary-list__key">Estimated matched</dt>
        <dd class="nhsuk-summary-list__value">{{ data.derived and data.derived.matchedEstimate or '—' }}</dd>
      </div>
    </dl>
  </div>
</div>

<form method="post" action="/researcher/volunteer-criteria">
  <div class="nhsuk-form-group">
    <fieldset class="nhsuk-fieldset">
      <legend class="nhsuk-fieldset__legend nhsuk-fieldset__legend--m">Age range</legend>
      <div class="nhsuk-radios">
        {% set ar = data.criteria and data.criteria.ageRange or '18-65' %}
        {% for opt in ['18-65','25-60','30-55','Custom'] %}
        <div class="nhsuk-radios__item">
          <input class="nhsuk-radios__input" id="age-{{ opt }}" name="ageRange" type="radio" value="{{ opt }}" {{ 'checked' if ar==opt }}>
          <label class="nhsuk-label nhsuk-radios__label" for="age-{{ opt }}">{{ opt }}</label>
        </div>
        {% endfor %}
      </div>
    </fieldset>
  </div>

  <div class="nhsuk-form-group">
    <fieldset class="nhsuk-fieldset">
      <legend class="nhsuk-fieldset__legend nhsuk-fieldset__legend--m">Require confirmed diagnosis</legend>
      {% set diag = data.criteria and data.criteria.diagnosisRequired or 'no' %}
      <div class="nhsuk-radios">
        <div class="nhsuk-radios__item">
          <input class="nhsuk-radios__input" id="diag-yes" name="diagnosisRequired" type="radio" value="yes" {{ 'checked' if diag=='yes' }}>
          <label class="nhsuk-label nhsuk-radios__label" for="diag-yes">Yes</label>
        </div>
        <div class="nhsuk-radios__item">
          <input class="nhsuk-radios__input" id="diag-no" name="diagnosisRequired" type="radio" value="no" {{ 'checked' if diag=='no' }}>
          <label class="nhsuk-label nhsuk-radios__label" for="diag-no">No</label>
        </div>
      </div>
    </fieldset>
  </div>

  <div class="nhsuk-form-group">
    <label class="nhsuk-label" for="travelMiles">Participants willing to travel up to (miles)</label>
    <input class="nhsuk-input nhsuk-input--width-5" id="travelMiles" name="travelMiles" type="number" min="0" value="{{ data.criteria and data.criteria.travelMiles or '10' }}">
    <span class="nhsuk-hint">Set to 0 for remote-only.</span>
  </div>

  <div class="nhsuk-form-group">
    <fieldset class="nhsuk-fieldset" aria-describedby="availability-hint">
      <legend class="nhsuk-fieldset__legend nhsuk-fieldset__legend--m">Availability</legend>
      <span id="availability-hint" class="nhsuk-hint">Pick typical days volunteers would be needed.</span>
      {% set days = data.criteria and data.criteria.availabilityDays or [] %}
      {% set opts = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'] %}
      <div class="nhsuk-checkboxes">
        {% for d in opts %}
        <div class="nhsuk-checkboxes__item">
          <input class="nhsuk-checkboxes__input" id="day-{{ d }}" name="availabilityDays" type="checkbox" value="{{ d }}" {{ 'checked' if d in days }}>
          <label class="nhsuk-label nhsuk-checkboxes__label" for="day-{{ d }}">{{ d }}</label>
        </div>
        {% endfor %}
      </div>
    </fieldset>
  </div>

  <div class="nhsuk-form-group">
    <fieldset class="nhsuk-fieldset" aria-describedby="exclusions-hint">
      <legend class="nhsuk-fieldset__legend nhsuk-fieldset__legend--m">Exclusions</legend>
      <span id="exclusions-hint" class="nhsuk-hint">Optional. Add any hard stops that would exclude volunteers.</span>
      {% set ex = data.criteria and data.criteria.exclusions or [] %}
      <div class="nhsuk-checkboxes">
        <div class="nhsuk-checkboxes__item">
          <input class="nhsuk-checkboxes__input" id="ex-1" name="exclusions" type="checkbox" value="contra-meds" {{ 'checked' if 'contra-meds' in ex }}>
          <label class="nhsuk-label nhsuk-checkboxes__label" for="ex-1">Contraindicated medications</label>
        </div>
        <div class="nhsuk-checkboxes__item">
          <input class="nhsuk-checkboxes__input" id="ex-2" name="exclusions" type="checkbox" value="safeguarding" {{ 'checked' if 'safeguarding' in ex }}>
          <label class="nhsuk-label nhsuk-checkboxes__label" for="ex-2">Safeguarding constraints</label>
        </div>
        <div class="nhsuk-checkboxes__item">
          <input class="nhsuk-checkboxes__input" id="ex-3" name="exclusions" type="checkbox" value="comorbidity" {{ 'checked' if 'comorbidity' in ex }}>
          <label class="nhsuk-label nhsuk-checkboxes__label" for="ex-3">Specific comorbidity exclusions</label>
        </div>
      </div>
    </fieldset>
  </div>

  <div class="nhsuk-button-group">
    <button class="nhsuk-button" type="submit" name="_action" value="save-and-continue">Save and continue</button>
    <button class="nhsuk-button nhsuk-button--secondary" type="submit">Save</button>
  </div>
</form>
{% endblock %}
